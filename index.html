<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <style>
        table,
        thead,
        tr,
        tbody,
        th,
        td {
            text-align: center;
        }

        th {
            font-weight:bold;
            color: black;
        }

        .nav-item.active {
            font-weight:bold;
            color:black;
        }
        .nav-item.active .nav-link {
            font-weight:bold;
            color:black;
        }

        tr {
            line-height: 4px;
            min-height: 4px;
            height: 4px;
        }

        .led-red {
            margin: 0 auto;
            width: 24px;
            height: 24px;
            background-color: #F00;
            border-radius: 50%;
            box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 12px;
        }

        .led-green {
            margin: 0 auto;
            width: 24px;
            height: 24px;
            background-color: #ABFF00;
            border-radius: 50%;
            box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #304701 0 -1px 9px, #89FF00 0 2px 12px;
        }

        .nav-item {
            font-size: 30px;
        }

        .rainbow-text {
            background-image: linear-gradient(to left, violet, indigo, blue, green, yellow, orange, red);   -webkit-background-clip: text;
            color: transparent;
        }
    </style>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">
        
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top">
                    <a class="navbar-brand d-flex align-items-center justify-content-center" href="/index.html">
                        <div class="navbar-brand-icon">
                            <i class="fas fa-chart-line" style="font-size: 25px;"></i>
                        </div>
                        <div class="navbar-brand-text mx-3 rainbow-text" style="font-size: 25px;">Dashboard</div>
                    </a>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                          <li class="nav-item active">
                            <a class="nav-link" href="/index.html"> <i class="fas fa-fw fa-tachometer-alt"></i> Home <span class="sr-only">(current)</span></a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link" href="/SecondPage.html"><i class="fas fa-fw fa-table"></i> Submit </a>
                          </li>
                        </ul>
                        <ul class="navbar-nav ml-auto" style="padding-right:100px; padding-top:10px;">
                            <li class="nav-item">
                                <div class="led-red"></div>BitoPro Status
                            </li>
                            
                        </ul>
                      </div>
                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">
    
                        <!-- DataTales Example -->
                        <div class="card shadow mb-4">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th rowspan="2" style="vertical-align: middle">Pair</th>
                                                <th colspan="2">MyBid1</th>
                                                <th colspan="2">Bid</th>
                                                <th colspan="2">Volume</th>
                                                <th rowspan="2" style="vertical-align: middle">Time</th>
                                                <th rowspan="2" style="vertical-align: middle">Past Profit</th>
                                                <th rowspan="2" style="vertical-align: middle">Spread</th>
                                                <th rowspan="2" style="vertical-align: middle">Quote</th>
                                                <th colspan="2">前次掛單</th>
                                                <th colspan="3">競品</th>
                                            </tr>
                                            <tr>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Spread</th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <th>Pair</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Time</th>
                                                <th>Past Profit</th>
                                                <th>Spread</th>
                                                <th>Quote</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Bid</th>
                                                <th>Ask</th>
                                                <th>Spread</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
    
                    </div>

                    <!-- Content Row -->

                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-4 col-lg-4">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">收益</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div>
                                        <canvas id="myChart"></canvas>
                                    </div>                                      
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-lg-4">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">收益率</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-lg-4">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">成交比重</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-4 col-lg-4">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">水位％</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Content Row -->
                    <div class="row">

                        <!-- Content Column -->
                        <div class="col-lg-6 mb-4">

                            <!-- Project Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Projects</h6>
                                </div>
                                <div class="card-body">
                                    <h4 class="small font-weight-bold">Server Migration <span
                                            class="float-right">20%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 20%"
                                            aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Sales Tracking <span
                                            class="float-right">40%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 40%"
                                            aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Customer Database <span
                                            class="float-right">60%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar" role="progressbar" style="width: 60%"
                                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Payout Details <span
                                            class="float-right">80%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: 80%"
                                            aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Account Setup <span
                                            class="float-right">Complete!</span></h4>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%"
                                            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Dashboard 2021</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>



    <!-- Chart.js for Canvas-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <script>
        /********************************************************
            Auto Create Table
        ********************************************************/
        var CoinList = ['BTC_TWD','ETH_TWD','DOGE_TWD','WOO_USDT','YFI_TWD','WOO_TWD','MANA_TWD',
        'ENJ_TWD','CHZ_TWD','ADA_TWD','ETH_USDT','SXP_TWD','MATIC_TWD','BTC_USDT','LTC_TWD',
        'ANKR_TWD','QUICK_TWD','CRO_TWD','AXS_TWD','DOT_TWD','QUICK_USDT','SHIB_TWD','CAKE_TWD',
        'BNB_TWD','XRP_TWD','TRX_TWD','BTT_TWD','HTT_TWD','FTT_TWD','MITH_USDT']

        url = 'wss://ace.io/socket.io/?EIO=3&transport=websocket'
        // tradeCurrencyId = self.TOKEN_TO_ID[pair]
        // baseCurrencyId = self.TOKEN_TO_ID[basecurrency]
        //res = requests.get("https://71a53ea8c008.ngrok.io/mminfo",auth=('admin', 'acepwd'))
        //print(res.json()['WNXMTWD'])
        let headers = new Headers();
        headers.set('Authorization', 'Basic ' + btoa('admin:acepwd'));
        headers.set('Content-Type', 'application/json');
        
        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;
        xhr.open("GET", "https://71a53ea8c008.ngrok.io/mminfo",'admin','acepwd');
        xhr.send(null);
        xhr.onreadystatechange = function () {  
            console.log(xhr.responseText) 
        };

        function tableCreate() {
            var body = document.getElementsByTagName('table')[0];
            var tbody = document.createElement('tbody');
            body.appendChild(tbody);
            for(var i = 0; i < CoinList.length; i++){
                var tr = document.createElement('tr');
                tbody.appendChild(tr);
                for(var j = 0; j <= 15; j++){
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    if(j == 0){
                        var inputElement = document.createElement('a');

                        inputElement.addEventListener('click', function(){
                            localStorage.setItem("storageName", this.getAttribute("id"));
                        });
                        inputElement.setAttribute("href", "/SecondPage.html");
                        inputElement.setAttribute("id", CoinList[i]);
                        td.appendChild(inputElement);
                        if(CoinList[i] == 'BTC_TWD' || CoinList[i] == 'ETH_TWD' || CoinList[i] == 'LTC_TWD' || CoinList[i] == 'BTC_USDT' || CoinList[i] == 'ETH_USDT')
                            inputElement.innerHTML = '.' + CoinList[i];
                        else
                            inputElement.innerHTML = CoinList[i]
                        
                    }else if(j == 9){
                        td.setAttribute('class', 'spread');
                        td.innerHTML = 1;
                    }
                    else if(j == 13){
                        td.setAttribute('class', CoinList[i] + '_competitive_price_bid');
                        td.innerHTML = 1;
                    }else if(j == 14){
                        td.setAttribute('class', CoinList[i] + '_competitive_price_ask');   
                        td.innerHTML = 1;
                    }else if(j == 15){
                        td.setAttribute('class', CoinList[i] + '_competitive_spread');   
                        td.innerHTML = 1;
                    }
                    else td.innerHTML = 1000
                }
                
            }
        }
        tableCreate();
        /********************************************************
              WebSocket to BitoPro to get competitive price.
        ********************************************************/
        var url = "wss://stream.bitopro.com:9443/ws/v1/pub/order-books?pairs=";
        //CoinList.length
        for(var i = 0; i < CoinList.length; i++){
            // console.log(url);
            url += CoinList[i];
            if(i < CoinList.length - 1) url += ',';
        }
        url += CoinList[0]
        if(url.indexOf("\b") != -1){
            url = url.replace(/.?\x08/, "= "); // 0x08 is the ASCII code for \b
            // console.log(url)
        }
        let ws = new WebSocket(url)

        //開啟websocket後，此 function 會被執行
        ws.onopen = () => {
            new Promise(resolve => setTimeout(resolve, 1000)).then(function(){
                document.getElementsByClassName('led-red')[0].setAttribute('class', 'led-green');
            });
        }

        //關閉後執行的動作，指定一個 function 會在連結中斷後執行
        ws.onclose = () => {
            document.getElementsByClassName('led-green')[0].setAttribute('class', 'led-red');
        }

        ws.onmessage = function(e) {
            var msg = JSON.parse(e.data);
            // console.log(msg['pair']);
            // console.log(msg['asks'][0]['price']);
            if(document.getElementsByClassName(msg['pair'] + '_competitive_price_ask')[0].innerHTML != msg['asks'][0]['price'])
                document.getElementsByClassName(msg['pair'] + '_competitive_price_ask')[0].innerHTML = msg['asks'][0]['price'];
            if(document.getElementsByClassName(msg['pair'] + '_competitive_price_ask')[0].innerHTML != msg['bids'][0]['price'])
                document.getElementsByClassName(msg['pair'] + '_competitive_price_bid')[0].innerHTML = msg['bids'][0]['price'];
            if(document.getElementsByClassName(msg['pair'] + '_competitive_spread')[0].innerHTML != parseFloat((msg['asks'][0]['price'] - msg['bids'][0]['price']).toFixed(6)))
                document.getElementsByClassName(msg['pair'] + '_competitive_spread')[0].innerHTML = parseFloat((msg['asks'][0]['price'] - msg['bids'][0]['price']).toFixed(6));
            //console.log(msg);
        }

        /********************************************************
            Spread Color Warning
        ********************************************************/
        var spread = document.getElementsByClassName('spread');
        for(var i = 0; i< spread.length; i++){
            // console.log(Number(spread[i].innerHTML))
            if (Number(spread[i].innerHTML) >= 1) {
                // console.log(1);
                spread[i].style["color"] = "red";
            }
        } 

        /********************************************************
            Profit Chart
        ********************************************************/
        const labels = [1,2,3,4,5,6,7];
        const data = {
            labels: labels,
            datasets: [{
                label: 'My First Dataset',
                data: [65, 59, 80, 81, 56, 55, 40],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };
        var myChart = new Chart(
            document.getElementById('myChart'),
            {
                type: 'line',
                data: data,
                options: {}
            }
        );
    </script>

    

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/datatables-demo.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/chart-area-demo.js"></script>
    <script src="js/demo/chart-pie-demo.js"></script>

</body>

</html>
